/** GreyFrame 
 * http://programmer.huang-home.net/GreyFrame/
 * 版权所有 (c) 2007 Programmer Huang (programmer.huang(a)gmail) 基于BSD协议
 * Copyright (c) 2007 Programmer Huang (programmer.huang(a)gmail) Under BSD licenses
 * Licenses: http://programmer.huang-home.net/GreyFrame/#LICENSES
 * $Id: GreyFrame.js 119 2010-01-11 05:56:37Z wucong $
 */

function GreyFrame(e,p,q){var a=this,H=false,u=navigator.userAgent,L=u.indexOf("Opera")>-1,x=u.indexOf("compatible")>-1&&u.indexOf("MSIE")>-1&&!L;u.indexOf("Firefox");u.indexOf("Safari");var B=0;if(x){/MSIE (\d+\.\d+);/.test(u);B=parseFloat(RegExp.$1)}var n=false,m=-1,o=-1,v=null,w=null;this.defaultWidth=p?p:400;this.defaultHeight=q?q:300;this.defaultY=this.defaultX=GreyFrame.PositionCenter;this.closed=true;this.closeButtonText="\u5173\u95ed";this.moveable=false;this.floatingFrame=true;this.disableHideOnClose= false;var C=GreyFrame.TitlePage,I=false,r=document.createElement("div");r.style.display="none";var h=document.createElement("div");h.className="GreyFrame_Bg";h.style.cssText="background-color: gray; ";h.style.position="absolute";h.style.filter="alpha(opacity=50)";h.style.MozOpacity=0.5;h.style.opacity=0.5;h.style.top="0px";h.style.left="0px";h.style.right="0px";h.style.bottom="0px";h.style.border="0px none gray";var i=document.createElement("iframe");i.style.border="0px none gray";i.style.width="100%"; i.style.filter="alpha(opacity=0)";i.style.MozOpacity=0;i.style.opacity=0;i.scrolling="no";i.src="about:blank";h.appendChild(i);r.appendChild(h);var f=document.createElement("div");f.className="GreyFrame_Fg";f.style.cssText="border: 1px solid #000000; ";f.style.display="none";f.style.position="absolute";f.style.textAlign="center";f.style.backgroundColor="#ffffff";var c=document.createElement("div");c.className="GreyFrame_TitleBar";c.style.cssText="color: #ffffff; background-color: #000000; text-align: center; "; c.style.height=GreyFrame.TitleHeight+"px";c.style.fontSize="14px";c.isMouseDown=false;c.xMoveBefore=0;c.yMoveBefore=0;c.xMouseBefore=0;c.yMouseBefore=0;GreyFrame._disableSelect(c);var l=document.createElement("span");l.className="GreyFrame_CloseButton";l.style.cssText="color: #ffffff; text-align: center; ";l.style.cssFloat="right";l.style.styleFloat="right";l.style.cursor=x&&B<6?"hand":"pointer";l.innerHTML=this.closeButtonText;l.onclick=function(){a.close()};var s=document.createElement("span"); s.className="GreyFrame_Title";s.style.cssText="padding: 2px 2px; word-wrap: nowrap; ";s.innerHTML="";c.appendChild(l);c.appendChild(s);var d=document.createElement(x?'<iframe name="'+e+'">':"iframe");d.style.backgroundColor="#ffffff";d.style.width=this.defaultWidth+"px";d.style.height=this.defaultHeight+"px";d.style.border="0px none #000000";d.style.dispaly="none";d.frameBorder=0;d.setAttribute("name",e);d.name=e;d.src="about:blank";var k=document.createElement("div");k.className="GreyFrame_HtmlContent"; k.style.cssText="overflow: auto; text-align: left; ";k.style.width="100%";k.style.border="0px none #000000";k.style.dispaly="none";f.appendChild(c);f.appendChild(d);f.appendChild(k);r.appendChild(f);var y=function(b){s.innerHTML=C?C:b?b:"&nbsp;"},D=function(){if(B==6)h.style.width=i.style.width=GreyFrame._getPage("Width");var b=GreyFrame._getPage("Height");if(b<GreyFrame._getView("Height"))b=GreyFrame._getView("Height");h.style.height=i.style.height=b+(x?34:0)+"px"},J=function(){n&&a.floatingFrame&& a.showFrame(v,w,m,o)};GreyFrame._addEventHandle(window,"scroll",J);var K=function(){if(n&&a.floatingFrame){D();a.showFrame(v,w,m,o)}};GreyFrame._addEventHandle(window,"resize",K);var E=function(b){a.closed=false;v=a.defaultX;w=a.defaultY;h.style.zIndex=++GreyFrame._zIndex;f.style.zIndex=++GreyFrame._zIndex;k.style.zIndex=++GreyFrame._zIndex;k.style.display="none";d.style.display="none";b.style.display="block";s.innerHTML=GreyFrame.TitleLoading;a.showBackground();a.showFrame(v,w,m,o);a.onOpenBefor()}; a._iframeWindowOnunloadHandle=function(){if(I)a._iframeWindowOnunloadHandle=null;else E(d)};a._gbIframeWindowOnunloadHandle=function(){I=true;a._gbIframeWindowOnunloadHandle=null};var F=false,z=function(){if(!F){F=true;var b=false;try{b=d.contentWindow&&d.contentWindow.location.href=="about:blank"?false:true}catch(g){b=true}if(b){y();try{d.contentWindow.ownerGreyFrame=a;d.contentWindow.close=function(){a.close()};y(d.contentWindow.document.title);GreyFrame._addEventHandle(d.contentWindow.document.body, "mousemove",c.onmousemove)}catch(j){}a.onOpenAfter()}else{if(H){a.onClose();if(!a.disableHideOnClose){a.hideFrame();a.hideBackground()}a.closed=true;try{GreyFrame._removeEventHandle(d.contentWindow.document.body,"mousemove",c.onmousemove)}catch(t){}}d.contentWindow.document.open();d.contentWindow.document.write('<html><head></head><body onunload="window.ownerGreyFrame._iframeWindowOnunloadHandle();"></body></html>');d.contentWindow.document.close();d.contentWindow.ownerGreyFrame=a;o=m=-1;H=true}F= false}};GreyFrame._addEventHandle(d,"load",z);this.onOpenBefor=function(){};this.onOpenAfter=function(){};this.onClose=function(){};this.showBackground=function(){D();r.style.display="block"};this.hideBackground=function(){r.style.display="none"};this.showFrame=function(b,g,j,t){if(j<0)j=this.defaultWidth;if(t<0)t=this.defaultHeight;if(b==GreyFrame.PositionCenter)b=(GreyFrame._getView("Width")-j)/2;if(g==GreyFrame.PositionCenter)g=(GreyFrame._getView("Height")-t)/2;f.style.top=GreyFrame._getScroll("Top")+ g+"px";f.style.left=GreyFrame._getScroll("Left")+b+"px";f.style.display="block";n=true;this.resize(j,t)};this.hideFrame=function(){f.style.display="none";n=false};this.open=function(b,g,j){if(g)m=g;if(j)o=j;d.src=b};this.openHtml=function(b,g,j,t){if(j)m=j;if(t)o=t;k.innerHTML=g;E(k);s.innerHTML=b};this.close=function(){d.src="about:blank"};this.resize=function(b,g){m=b;o=g;b=m-GreyFrame._valueInt(c.style.borderLeftWidth)-GreyFrame._valueInt(c.style.borderRightWidth);g=m-GreyFrame._valueInt(d.style.borderLeftWidth)- GreyFrame._valueInt(d.style.borderRightWidth);var j=o-GreyFrame._valueInt(d.style.borderTopWidth)-GreyFrame._valueInt(d.style.borderBottomWidth);if(b<0)b=0;if(g<0)g=0;if(j<0)j=0;c.style.width=b+"px";d.style.width=g+"px";d.style.height=j+"px";k.style.width=g+"px";k.style.height=j+"px"};this.setTitle=function(b){C=b;n&&y()};this.moveTo=function(b,g){v=b;w=g;this.showFrame(v,w,m,o)};this.getX=function(){if(!n)return null;return f.offsetLeft};this.getY=function(){if(!n)return null;return f.offsetTop}; this.getWidth=function(){if(!n)return null;return d.offsetWidth};this.getHeight=function(){if(!n)return null;return d.offsetHeight};this.setCloseButtonText=function(b){this.closeButtonText=b;l.innerHTML=b};this.setClassName=function(b){r.className=b};var A=function(){window.document.body.appendChild(r);i.contentWindow.document.open();i.contentWindow.document.write('<html><head></head><body onunload="window.ownerGreyFrame._gbIframeWindowOnunloadHandle();"></body></html>');i.contentWindow.document.close(); i.contentWindow.ownerGreyFrame=a;d.src="about:blank";c.onmousedown=function(b){if(a.moveable){b=b?b:window.event;c.isMouseDown=true;c.xMoveBefore=a.getX();c.yMoveBefore=a.getY();c.xMouseBefore=b.screenX;c.yMouseBefore=b.screenY;c.style.cursor="move"}};c.onmousemove=function(b){if(a.moveable)if(c.isMouseDown){b=b?b:window.event;a.moveTo(c.xMoveBefore+b.screenX-c.xMouseBefore-GreyFrame._getScroll("Left"),c.yMoveBefore+b.screenY-c.yMouseBefore-GreyFrame._getScroll("Top"))}};GreyFrame._addEventHandle(i.contentWindow.document.body, "mousemove",c.onmousemove);c.onmouseup=function(){if(a.moveable){c.isMouseDown=false;c.xMoveBefore=0;c.yMoveBefore=0;c.xMouseBefore=0;c.yMouseBefore=0;c.style.cursor=""}};GreyFrame._removeEventHandle(window,"load",A);A=null};if(GreyFrame._WindowLoaded){A();z()}else GreyFrame._addEventHandle(window,"load",A);var G=function(){GreyFrame._removeEventHandle(d,"load",z);GreyFrame._removeEventHandle(window,"unload",G);GreyFrame._removeEventHandle(i.contentWindow.document.body,"mousemove",c.onmousemove); a.getHeight=null;a.getWidth=null;a.getY=null;a.getX=null;a.moveTo=null;a.setTitle=null;a.resize=null;a.close=null;a.open=null;a.hideFrame=null;a.showFrame=null;a.hideBackground=null;a.showBackground=null;a.onClose=null;a.onOpenAfter=null;s=d=k=D=J=K=a.onOpenBefor=null;l=l.onclick=null;c.onmousedown=null;c.onmousemove=null;G=z=E=y=r=h=i=f=c=c.onmouseup=null};GreyFrame._addEventHandle(window,"unload",G)}GreyFrame._zIndex=6E4;GreyFrame._WindowLoaded=false;GreyFrame.TitleHeight=18; GreyFrame.TitlePage=null;GreyFrame.TitleLoading="\u6b63\u5728\u8f7d\u5165...";GreyFrame.PositionCenter=null;GreyFrame._addEventHandle=function(e,p,q){e.addEventListener?e.addEventListener(p,q,false):e.attachEvent("on"+p,q)};GreyFrame._removeEventHandle=function(e,p,q){e.removeEventListener?e.removeEventListener(p,q,false):e.detachEvent("on"+p,q)};GreyFrame._valueInt=function(e){e=parseInt(e);return isNaN(e)?0:e}; GreyFrame._getView=function(e){return document.compatMode=="CSS1Compat"?document.documentElement["client"+e]:document.body["client"+e]};GreyFrame._getScroll=function(e){return Math.max(document.documentElement["scroll"+e],document.body["scroll"+e])}; GreyFrame._getPage=function(e){return e=="Width"?window.innerWidth&&window.scrollMaxX?window.innerWidth+window.scrollMaxX:document.body.scrollWidth>document.body.offsetWidth?document.body.scrollWidth:document.body.offsetWidth+document.body.offsetLeft:window.innerHeight&&window.scrollMaxY?window.innerHeight+window.scrollMaxY:document.body.scrollHeight>document.body.offsetHeight?document.body.scrollHeight:document.body.offsetHeight+document.body.offsetTop}; GreyFrame._disableSelect=function(e){e.unselectable="on";e.onselectstart=function(){return false};if(e.style)e.style.MozUserSelect="none"};GreyFrame._addEventHandle(window,"load",function(){GreyFrame._WindowLoaded=true});
